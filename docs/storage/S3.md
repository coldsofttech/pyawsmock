# ü™£ MockS3 - Local S3 Mock

A local **mock implementation of AWS S3** for testing and development purposes. This mock allows you to simulate S3
operations without using real AWS resources, making unit testing and offline development faster and safer.

---

## ‚ö° Highlights

- Simulates **S3 bucket creation, object storage, and retrieval**.
- Supports **bucket metadata, ACLs, policies, and public access block configurations**.
- Implements **file upload/download** with **checksum validation**.
- Handles **mocked metadata and inventory configurations**.
- Fully **local file-system backed**, storing bucket and object info as JSON and actual files in directories.

---

## üìñ Overview

`MockS3` mimics the AWS S3 client interface and can be used as a drop-in replacement for **unit testing
** your S3-related code. It stores metadata in JSON files and actual object contents in a local directory tree.
---

## üöÄ Key Features

| Feature                              | Description                                                                        |
|--------------------------------------|------------------------------------------------------------------------------------|
| create_bucket                        | 	Create a new S3 bucket with optional tags, ACLs, versioning, and configuration.   |
| upload_file / download_file          | 	Upload and download files to/from buckets, with optional checksums and callbacks. |
| get_object                           | 	Retrieve object content and metadata with support for ranges and preconditions.   |
| create_bucket_metadata_configuration | 	Configure metadata tables, journal, and inventory for a bucket.                   |
| update_bucket_metadata_*             | 	Update inventory or journal metadata configurations.                              |
| get_bucket_metadata_configuration    | 	Retrieve bucket metadata configuration in mock format.                            |
| delete_bucket_metadata_configuration | 	Delete metadata configuration from a bucket.                                      |
| put/get_bucket_acl                   | 	Mock bucket ACL management.                                                       |
| put/get/delete_public_access_block	  | Mock public access block configuration.                                            |
| put/get/delete_bucket_policy	        | Mock bucket policies and status evaluation.                                        |

---

## üèóÔ∏è Instantiation

```python
from pyawsmock import configure_mock, client

# Configure local mock (persistent storage)
configure_mock(mode="persistent", path="./local_s3")

# Create MockSSM client
s3 = client("s3", region_name="local-us-east-1")
```

> üîë `region_name` must start with `local-` for mock behavior; otherwise it delegates to real AWS.
---

## üõ†Ô∏è Methods & Examples

### `create_bucket`

```python
response = s3.create_bucket(
    Bucket="test-bucket",
    ACL="private",
    CreateBucketConfiguration={
        "LocationConstraint": "local-us-east-1",
        "Tags": [{"Key": "env", "Value": "dev"}]
    }
)
print(response)
# Output:
# {'Location': '/test-bucket', 'BucketArn': 'arn:mock:s3::000000000000:test-bucket', 'ResponseMetadata': {'HTTPStatusCode': 200}}
```

---

### `upload_file`

```python
s3.upload_file(
    Filename="/tmp/file.txt",
    Bucket="test-bucket",
    Key="folder/file.txt"
)
```

- **Supports:** ExtraArgs for metadata, checksum validation, callback for progress.
- **Creates directories** locally as needed.

---

### `download_file`

```python
s3.download_file(
    Bucket="test-bucket",
    Key="folder/file.txt",
    Filename="/tmp/downloaded.txt"
)
```

- **Supports checksum validation** if enabled.
- Respects local file-system paths.

---

### `get_object`

```python
response = s3.get_object(
    Bucket="test-bucket",
    Key="folder/file.txt",
    Range="bytes=0-10"
)
print(response['Body'].read())
```

- **Supports byte ranges, metadata, SSE mock fields**.
- Versioning and multipart downloads are **mocked only with warnings**.

---

### Bucket Metadata

```python
s3.create_bucket_metadata_configuration(
    Bucket="test-bucket",
    MetadataConfiguration={
        "JournalTableConfiguration": {"RecordExpiration": {"Expiration": "ENABLED", "Days": 30}},
        "InventoryTableConfiguration": {"ConfigurationState": "ENABLED"}
    }
)

metadata = s3.get_bucket_metadata_configuration(Bucket="test-bucket")
print(metadata)
```

- Mocked journal and inventory tables with default `ACTIVE` status.
- Checksum and MD5 validation available (mock).

---

### ACLs, Policies & Public Access

```python
s3.put_bucket_acl(Bucket="test-bucket", ACL="public-read")
acl_info = s3.get_bucket_acl(Bucket="test-bucket")
print(acl_info)
```

- Supports `put/get/delete` for ACLs, bucket policy, and public access block.
- Policies are **mock-validated**, public access detection simplified.

---

## ‚ö†Ô∏è Limitations (Mock-Specific)

- No real AWS connectivity ‚Äî fully local simulation.
- Versioning and multipart operations are not fully implemented.
- SSE-C (customer-provided encryption) is mocked only; data is not encrypted.
- Some S3TransferConfig options are ignored, with warnings.
- Public access block and bucket policies are simplified for local testing.
- Checksum validation is optional and mocked using SHA256, CRC, etc.
- File paths are local file-system paths, not S3 URIs.
- Metadata and inventory tables are mocked defaults, not actual AWS tables.